<?php

require_once('incl/old.incl.php');

function json_decode2($json,$dbg=false) {
	$tr = array();
	$escape = 0; $instr = 0;
	$nm = ''; $vl = ''; $atnm = true;
	$strtype = ''; 

	if ($dbg) echo "\n$json\n";

	for ($i=0; $i<strlen($json); $i++) {
		$c = $json[$i];
		if ($dbg) echo "$c instr=$instr escape=$escape atnm=$atnm\n";
		if ($escape > 0) {
			if ($atnm) $nm .= $c; else $vl .= $c;
			$escape--;
		} elseif ($instr > 0) {
			switch($c) {
				case $strtype:
				case ']':
					$instr--;
					break;
				case '[':
					$instr++;
					break;
				case '\\':
					$c = '';
					$escape++;
					break;
			}
			if ($instr > 0) {
				if ($atnm) $nm .= $c; else $vl .= $c;
			}
		} else {
			switch ($c) {
				case '\\': $escape++; break;
				case ':': $atnm = false; break;
				case '\'': 
				case '"': $strtype=$c; $instr++; break;
				case ']': break;
				case '[': $instr++; break;
				case '{': $curarray = array(); break;
				case '}':
				case ',':
					if (isset($curarray)) $curarray[$nm] = ((substr($vl,0,1)=='{')?json_decode2($vl):$vl);
					$nm = ''; $vl = ''; $atnm = true;
					if ($c!='}') break;
					$tr[] = $curarray;
					unset($curarray);
					break;
				default:
					if ($atnm) $nm .= $c; else $vl .= $c;
			}
		}
	}
	if ($dbg) { print_r($tr); cleanup(''); }
	return $tr;
}

do_connect();
run_sql('delete from tblDBCItemVendorCost');

//$whpage was get_url_old('http://www.wowhead.com/items?filter=qu=1;cr=87:92:86;crs=11:1:12;crv=0:0:0;gb=0');
// used to do this: delete FROM `tblItemVendorCost` where itemid in (52185,53010,52555,43007)

// use this instead to include better-than-common: http://www.wowhead.com/items?filter=cr=87:92:86;crs=11:1:12;crv=0:0:0
// see http://www.wowhead.com/items?filter=cr=92:158:86:87;crs=1:-2323:12:11;crv=0:0:0:0 to exclude some


$thejson = <<<EOF
{"classs":7,"id":76061,"level":90,"name":"4Spirit of Harmony","reqlevel":89,"slot":0,"source":[2,3,4],"sourcemore":[{"p":3},{"c":6138,"c2":12,"n":"Many More Giant Dinosaur Bones","t":5,"ti":32615}],"subclass":10,firstseenpatch: 0,"buyprice":9999999,cost:[0,[[392,600]],[]]},{"classs":3,"id":76734,"level":90,"name":"4Serpent's Eye","slot":0,"source":[5],"sourcemore":[{"z":5840}],"subclass":8,firstseenpatch: 0,"avgbuyout":75900,"sellprice":5000,cost:[0,[],[[76061,1]]]},{"classs":7,"id":80433,"level":90,"name":"4Blood Spirit","slot":0,"source":[2,5,15],"sourcemore":[{"z":6507}],"subclass":12,firstseenpatch: 0,"avgbuyout":97013,"buyprice":99999999,cost:[0,[[396,400]],[]]},{"classs":7,"id":83092,"level":90,"name":"4Orb of Mystery","slot":0,"source":[2,5],"sourcemore":[{"icon":"inv_misc_gift_03","n":"Blingtron 4000 Gift Package","q":2,"t":3,"ti":86623},{"n":"Big Keech","t":1,"ti":61650,"z":5840}],"subclass":11,firstseenpatch: 0,"avgbuyout":1000000,"buyprice":200000000,cost:[200000000]},{"classs":7,"id":72094,"level":90,"name":"5Black Trillium Ore","reqlevel":80,"slot":0,"source":[2,5,19],"sourcemore":[{"z":5840}],"subclass":7,firstseenpatch: 0,"avgbuyout":79781,"reqskill":755,"reqskillrank":600,"sellprice":350,cost:[0,[],[[76061,1]]]},{"classs":7,"id":72103,"level":90,"name":"5White Trillium Ore","reqlevel":80,"slot":0,"source":[2,5,19],"sourcemore":[{"z":5840}],"subclass":7,firstseenpatch: 0,"avgbuyout":78947,"reqskill":755,"reqskillrank":600,"sellprice":350,cost:[0,[],[[76061,1]]]},{"classs":7,"id":72238,"level":90,"name":"5Golden Lotus","slot":0,"source":[2,5,17],"sourcemore":[{"z":5840}],"subclass":9,firstseenpatch: 0,"avgbuyout":390750,"sellprice":1,cost:[0,[],[[76061,1]]]},{"classs":7,"id":72093,"level":88,"name":"6Kyparite","reqlevel":80,"slot":0,"source":[2,5,19],"sourcemore":[{"z":5840}],"subclass":7,firstseenpatch: 0,"avgbuyout":20100,"reqskill":755,"reqskillrank":550,"sellprice":750,cost:[0,[],[[76061,1]]]},{"classs":7,"id":79101,"level":88,"name":"6Prismatic Scale","slot":0,"source":[2,5,23],"sourcemore":[{"z":5840}],"subclass":6,firstseenpatch: 0,"avgbuyout":16297,"sellprice":500,cost:[0,[],[[76061,1]]]},{"classs":7,"id":72092,"level":86,"name":"6Ghost Iron Ore","reqlevel":75,"slot":0,"source":[2,5,19,23],"sourcemore":[{"z":5840}],"subclass":7,firstseenpatch: 0,"avgbuyout":21694,"reqskill":755,"reqskillrank":500,"sellprice":1500,cost:[0,[],[[76061,1]]]},{"classs":7,"id":72988,"level":86,"name":"6Windwool Cloth","slot":0,"source":[2,5,21],"sourcemore":[{"z":5840}],"subclass":5,firstseenpatch: 0,"avgbuyout":13076,"sellprice":1750,cost:[0,[],[[76061,1]]]},{"classs":7,"id":52722,"level":85,"name":"3Maelstrom Crystal","slot":0,"source":[3,15],"sourcemore":[{"p":3}],"subclass":12,firstseenpatch: 0,"avgbuyout":1597500,"buyprice":120000,cost:[0,[[395,3750]],[]]},{"classs":3,"id":52196,"level":85,"name":"4Chimera's Eye","reqlevel":75,"slot":0,"source":[2,5],"sourcemore":[{"icon":"inv_misc_gem_ruby_01","n":"Fire Prism","q":3,"t":3,"ti":52304}],"subclass":8,firstseenpatch: 0,"avgbuyout":1960000,"reqskill":755,"reqskillrank":500,"sellprice":5000,cost:[0,[[361,1]],[]]},{"classs":7,"id":52980,"level":85,"name":"4Pristine Hide","slot":0,"source":[5],"subclass":6,firstseenpatch: 0,"avgbuyout":3289999,"buyprice":130000,"sellprice":32500,cost:[0,[],[[56516,10]]]},{"classs":7,"id":65893,"level":85,"name":"4Sands of Time","reqlevel":75,"slot":0,"source":[5],"subclass":11,firstseenpatch: 0,"buyprice":30000000,"reqskill":171,"reqskillrank":525,cost:[30000000]},{"classs":0,"id":58265,"level":85,"name":"6Highland Pomegranate","reqlevel":85,"slot":0,"source":[2,5],"sourcemore":[{"icon":"inv_crate_03","n":"Sealed Crate","q":1,"t":3,"ti":67597}],"subclass":5,firstseenpatch: 0,"avgbuyout":44000,"buyprice":20000,"cooldown":1000,"reqlevel":85,"sellprice":1000,cost:[20000]},{"classs":7,"id":65892,"level":85,"name":"6Pyrium-Laced Crystalline Vial","slot":0,"source":[5],"sourcemore":[{"n":"Yasmin","t":1,"ti":49406,"z":5034}],"subclass":11,firstseenpatch: 0,"avgbuyout":1,"buyprice":50000000,"sellprice":125000,cost:[50000000]},{"classs":7,"id":67319,"level":85,"name":"6Preserved Ogre Eye","slot":0,"source":[2,5],"sourcemore":[{"icon":"inv_box_04","n":"Flame-Scarred Junkbox","q":1,"t":3,"ti":63349},{"z":4922}],"subclass":1,firstseenpatch: 0,"avgbuyout":640000,"buyprice":328990,"sellprice":8224,cost:[328990]},{"classs":7,"id":67335,"level":85,"name":"6Silver Charm Bracelet","slot":0,"source":[2,5],"sourcemore":[{"icon":"inv_box_04","n":"Flame-Scarred Junkbox","q":1,"t":3,"ti":63349},{"z":4922}],"subclass":1,firstseenpatch: 0,"avgbuyout":384000,"buyprice":445561,"sellprice":11139,cost:[445561]},{"classs":7,"id":74659,"level":85,"name":"6Farm Chicken","slot":0,"source":[5],"subclass":8,firstseenpatch: 0,"avgbuyout":70000,"buyprice":30000,"sellprice":7500,cost:[30000]},{"classs":7,"id":74660,"level":85,"name":"6Pandaren Peach","slot":0,"source":[5],"subclass":8,firstseenpatch: 0,"avgbuyout":69999,"buyprice":15000,"sellprice":3750,cost:[15000]},{"classs":7,"id":74661,"level":85,"name":"6Black Pepper","reqlevel":85,"slot":0,"source":[4,5],"sourcemore":[{"c":5981,"c2":12,"n":"A Present for Teacher","t":5,"ti":31820},{"n":"Nam Ironpaw","t":1,"ti":64395,"z":5805}],"subclass":8,firstseenpatch: 0,"avgbuyout":444510,"buyprice":10000,"sellprice":2500,cost:[0,[[402,1]],[]]},{"classs":7,"id":74662,"level":85,"name":"6Rice Flour","reqlevel":85,"slot":0,"source":[4,5],"sourcemore":[{"c":5981,"c2":12,"n":"A Present for Teacher","t":5,"ti":31820},{"n":"Nam Ironpaw","t":1,"ti":64395,"z":5805}],"subclass":8,firstseenpatch: 0,"avgbuyout":462000,"buyprice":10000,"sellprice":2500,cost:[0,[[402,1]],[]]},{"classs":7,"id":74832,"level":85,"name":"6Barley","slot":0,"source":[5],"subclass":8,firstseenpatch: 0,"avgbuyout":119000,"buyprice":12000,"sellprice":3000,cost:[12000]},{"classs":7,"id":74845,"level":85,"name":"6Ginseng","reqlevel":85,"slot":0,"source":[4,5],"sourcemore":[{"c":5981,"c2":12,"n":"Way of the Brew","t":5,"ti":31479}],"subclass":8,firstseenpatch: 0,"avgbuyout":109800,"buyprice":35000,"sellprice":8750,cost:[35000]},{"classs":7,"id":74851,"level":85,"name":"6Rice","slot":0,"source":[5],"subclass":8,firstseenpatch: 0,"avgbuyout":87500,"buyprice":14000,"sellprice":3500,cost:[14000]},{"classs":7,"id":74852,"level":85,"name":"6Yak Milk","slot":0,"source":[5],"subclass":8,firstseenpatch: 0,"avgbuyout":80499,"buyprice":16000,"sellprice":4000,cost:[16000]},{"classs":7,"id":74853,"level":85,"name":"6100 Year Soy Sauce","reqlevel":85,"slot":0,"source":[4,5],"sourcemore":[{"c":5981,"c2":12,"n":"A Present for Teacher","t":5,"ti":31820},{"n":"Nam Ironpaw","t":1,"ti":64395,"z":5805}],"subclass":8,firstseenpatch: 0,"avgbuyout":458999,"buyprice":10000,"sellprice":2500,cost:[0,[[402,1]],[]]},{"classs":7,"id":74854,"level":85,"name":"6Instant Noodles","slot":0,"source":[5],"subclass":8,firstseenpatch: 0,"avgbuyout":110000,"buyprice":7000,"sellprice":1750,cost:[7000]},{"classs":7,"id":85583,"level":85,"name":"6Needle Mushrooms","slot":0,"source":[5],"subclass":8,firstseenpatch: 0,"avgbuyout":66121,"buyprice":12000,"sellprice":3000,cost:[12000]},{"classs":7,"id":85584,"level":85,"name":"6Silkworm Pupa","slot":0,"source":[5],"subclass":8,firstseenpatch: 0,"avgbuyout":40000,"buyprice":17000,"sellprice":4250,cost:[17000]},{"classs":7,"id":85585,"level":85,"name":"6Red Beans","slot":0,"source":[5],"subclass":8,firstseenpatch: 0,"avgbuyout":70000,"buyprice":27000,"sellprice":6750,cost:[27000]},{"classs":7,"id":102539,"level":85,"name":"6Fresh Strawberries","slot":0,"source":[5],"sourcemore":[{"n":"Merchant Tantan","t":1,"ti":59341}],"subclass":8,firstseenpatch: 0,"buyprice":5000,"sellprice":250,cost:[5000]},{"classs":7,"id":102540,"level":85,"name":"6Fresh Mangos","slot":0,"source":[5],"sourcemore":[{"n":"Merchant Tantan","t":1,"ti":59341}],"subclass":8,firstseenpatch: 0,"buyprice":5000,"sellprice":250,cost:[5000]},{"classs":7,"id":52719,"level":83,"name":"5Greater Celestial Essence","slot":0,"source":[3,15],"sourcemore":[{"p":3}],"subclass":12,firstseenpatch: 0,"avgbuyout":472999,"buyprice":120000,"cooldown":500,cost:[0,[[392,400]],[]]},{"classs":7,"id":52185,"level":83,"name":"6Elementium Ore","reqlevel":75,"slot":0,"source":[2,3,19],"sourcemore":[{"p":3}],"subclass":7,firstseenpatch: 0,"avgbuyout":30833,"buyprice":180000,"reqskill":755,"reqskillrank":475,"sellprice":2250,cost:[0,[[392,1000]],[]]},{"classs":7,"id":52188,"level":81,"name":"6Jeweler's Setting","slot":0,"source":[5],"subclass":1,firstseenpatch: 0,"avgbuyout":55000,"buyprice":15000,"sellprice":3750,cost:[15000]},{"classs":7,"id":52555,"level":81,"name":"6Hypnotic Dust","slot":0,"source":[3,15],"sourcemore":[{"p":3}],"subclass":12,firstseenpatch: 0,"avgbuyout":83500,"buyprice":24000,cost:[0,[[392,100]],[]]},{"classs":7,"id":53010,"level":81,"name":"6Embersilk Cloth","slot":0,"source":[2,3],"sourcemore":[{"p":3}],"subclass":5,firstseenpatch: 0,"avgbuyout":31818,"buyprice":120000,"sellprice":1500,cost:[0,[[395,1250]],[]]},{"classs":7,"id":62323,"level":81,"name":"6Deathwing Scale Fragment","slot":0,"source":[2,5],"sourcemore":[{"icon":"inv_box_04","n":"Flame-Scarred Junkbox","q":1,"t":3,"ti":63349},{"z":4922}],"subclass":1,firstseenpatch: 0,"avgbuyout":480000,"buyprice":60000,"sellprice":5000,cost:[60000]},{"classs":3,"id":42225,"level":80,"name":"4Dragon's Eye","reqlevel":50,"slot":0,"source":[2,5],"sourcemore":[{"icon":"inv_misc_gem_diamond_02","n":"Icy Prism","q":3,"t":3,"ti":44943}],"subclass":8,firstseenpatch: 0,"avgbuyout":510000,"reqskill":755,"reqskillrank":350,cost:[0,[[61,1]],[]]},{"classs":7,"id":43102,"level":80,"name":"4Frozen Orb","slot":0,"source":[2,5],"sourcemore":[{"bd":1,"z":4395}],"subclass":11,firstseenpatch: 0,"avgbuyout":111111,"sellprice":50000,cost:[0,[[395,110]],[]]},{"classs":7,"id":44499,"level":80,"name":"4Salvaged Iron Golem Parts","reqlevel":65,"slot":0,"source":[5],"subclass":1,firstseenpatch: 0,"buyprice":30000000,"reqskill":202,"reqskillrank":450,cost:[30000000]},{"classs":7,"id":44500,"level":80,"name":"4Elementium-Plated Exhaust Pipe","reqlevel":65,"slot":0,"source":[5],"subclass":1,firstseenpatch: 0,"buyprice":15000000,"reqskill":202,"reqskillrank":450,cost:[15000000]},{"classs":7,"id":44501,"level":80,"name":"4Goblin-Machined Piston","reqlevel":65,"slot":0,"source":[5],"subclass":1,firstseenpatch: 0,"buyprice":10000000,"reqskill":202,"reqskillrank":450,cost:[10000000]},{"classs":7,"id":45087,"level":80,"name":"4Runed Orb","slot":0,"source":[2,5],"sourcemore":[{"z":4273},{"z":4395}],"subclass":11,firstseenpatch: 0,"avgbuyout":111111,"sellprice":50000,cost:[0,[],[[43102,4]]]},{"classs":7,"id":47556,"level":80,"name":"4Crusader Orb","slot":0,"source":[2,5],"sourcemore":[{"bd":1,"z":4722}],"subclass":11,firstseenpatch: 0,"avgbuyout":610000,"sellprice":60000,cost:[0,[],[[43102,6]]]},{"classs":7,"id":49908,"level":80,"name":"4Primordial Saronite","slot":0,"source":[2,5],"sourcemore":[{"z":4812}],"subclass":11,firstseenpatch: 0,"avgbuyout":939293,"buyprice":280000,"sellprice":70000,cost:[0,[[395,266]],[]]},{"classs":7,"id":36908,"level":80,"name":"5Frost Lotus","slot":0,"source":[2,5,17],"sourcemore":[{"n":"Frozo the Renowned","t":1,"ti":40160,"z":4395}],"subclass":9,firstseenpatch: 0,"avgbuyout":19800,"buyprice":40000,"sellprice":10000,cost:[0,[],[[43102,1]]]},{"classs":7,"id":40533,"level":80,"name":"6Walnut Stock","slot":0,"source":[5],"subclass":1,firstseenpatch: 0,"avgbuyout":50000,"buyprice":50000,"sellprice":12500,cost:[50000]},{"classs":7,"id":43007,"level":80,"name":"6Northern Spices","slot":0,"source":[2,5],"sourcemore":[{"icon":"inv_misc_bag_11","n":"Small Spice Bag","q":1,"t":3,"ti":44113}],"subclass":11,firstseenpatch: 0,"avgbuyout":4100,cost:[0,[[81,1]],[]]},{"classs":7,"id":30183,"level":75,"name":"3Nether Vortex","slot":0,"source":[2,5],"sourcemore":[{"n":"G'eras","t":1,"ti":18525,"z":3703}],"subclass":13,firstseenpatch: 0,"avgbuyout":18623,"sellprice":20000,cost:[0,[[395,78]],[]]},{"classs":3,"id":36784,"level":75,"name":"4Siren's Tear","slot":0,"source":[2,5],"sourcemore":[{"n":"Ahlurglgr","t":1,"ti":25206,"z":3537}],"subclass":7,firstseenpatch: 0,"avgbuyout":120000,"sellprice":10000,cost:[0,[],[[34597,100]]]},{"classs":7,"id":44128,"level":75,"name":"4Arctic Fur","slot":0,"source":[5,23],"sourcemore":[{"n":"Braeg Stoutbeard","t":1,"ti":32515,"z":4395}],"subclass":6,firstseenpatch: 0,"avgbuyout":345000,"buyprice":120000,"sellprice":30000,cost:[0,[],[[38425,10]]]},{"classs":3,"id":36783,"level":75,"name":"5Northsea Pearl","slot":0,"source":[2,5],"sourcemore":[{"n":"Ahlurglgr","t":1,"ti":25206,"z":3537}],"subclass":7,firstseenpatch: 0,"avgbuyout":27500,"sellprice":5000,cost:[0,[],[[34597,30]]]},{"classs":0,"id":35948,"level":75,"name":"6Savory Snowplum","reqlevel":75,"slot":0,"source":[2,5,21],"subclass":5,firstseenpatch: 0,"avgbuyout":22000,"buyprice":16000,"cooldown":1000,"reqlevel":75,"sellprice":800,cost:[16000]},{"classs":0,"id":58278,"level":75,"name":"6Tropical Sunfruit","reqlevel":75,"slot":0,"source":[5],"subclass":5,firstseenpatch: 0,"avgbuyout":52400,"buyprice":16000,"cooldown":1000,"reqlevel":75,"sellprice":800,cost:[16000]},{"classs":7,"id":39684,"level":71,"name":"6Hair Trigger","slot":0,"source":[5],"subclass":1,firstseenpatch: 0,"avgbuyout":250000,"buyprice":9000,"sellprice":2250,cost:[9000]},{"classs":3,"id":32227,"level":70,"name":"3Crimson Spinel","slot":0,"source":[2,5,19],"subclass":0,firstseenpatch: 0,"avgbuyout":52000,"sellprice":50000,cost:[0,[[395,220]],[]]},{"classs":3,"id":32228,"level":70,"name":"3Empyrean Sapphire","slot":0,"source":[2,5,19],"subclass":1,firstseenpatch: 0,"avgbuyout":48999,"sellprice":50000,cost:[0,[[395,220]],[]]},{"classs":3,"id":32229,"level":70,"name":"3Lionseye","slot":0,"source":[2,5,19],"subclass":2,firstseenpatch: 0,"avgbuyout":48750,"sellprice":50000,cost:[0,[[395,220]],[]]},{"classs":3,"id":32230,"level":70,"name":"3Shadowsong Amethyst","slot":0,"source":[2,5,19],"subclass":3,firstseenpatch: 0,"avgbuyout":49855,"sellprice":50000,cost:[0,[[395,220]],[]]},{"classs":3,"id":32231,"level":70,"name":"3Pyrestone","slot":0,"source":[2,5,19],"subclass":5,firstseenpatch: 0,"avgbuyout":49578,"sellprice":50000,cost:[0,[[395,220]],[]]},{"classs":3,"id":32249,"level":70,"name":"3Seaspray Emerald","slot":0,"source":[2,5,19],"subclass":4,firstseenpatch: 0,"avgbuyout":48800,"sellprice":50000,cost:[0,[[395,220]],[]]},{"classs":7,"id":22791,"level":70,"name":"6Netherbloom","reqlevel":35,"slot":0,"source":[2,5,17],"subclass":9,firstseenpatch: 0,"avgbuyout":31250,"buyprice":4000,"reqskill":773,"reqskillrank":275,"sellprice":1000,cost:[4000]},{"classs":7,"id":22793,"level":70,"name":"6Mana Thistle","reqlevel":35,"slot":0,"source":[5,17],"subclass":9,firstseenpatch: 0,"avgbuyout":17500,"buyprice":6000,"reqskill":773,"reqskillrank":275,"sellprice":1500,cost:[6000]},{"armor":0,"classs":4,"displayid":47772,"id":34249,"level":70,"name":"6Hula Girl Doll","slot":2,"slotbak":2,"source":[5],"subclass":-3,firstseenpatch: 0,"avgbuyout":1900000,"buyprice":1000000,"displayid":47772,"sellprice":250000,"slotbak":2,cost:[1000000]},{"classs":7,"id":38426,"level":70,"name":"6Eternium Thread","slot":0,"source":[2,5],"subclass":5,firstseenpatch: 0,"avgbuyout":18571,"buyprice":30000,"sellprice":7500,cost:[30000]},{"classs":7,"id":23572,"level":65,"name":"4Primal Nether","slot":0,"source":[2,5],"sourcemore":[{"bd":1,"n":"G'eras","t":1,"ti":18525,"z":3703}],"subclass":13,firstseenpatch: 0,"avgbuyout":14179,"sellprice":16000,cost:[0,[[395,52]],[]]},{"classs":7,"id":22577,"level":65,"name":"6Mote of Shadow","slot":0,"source":[2,5],"subclass":10,firstseenpatch: 0,"avgbuyout":3400,"buyprice":1600,"cooldown":500,"sellprice":400,cost:[1600]},{"classs":7,"id":22578,"level":65,"name":"6Mote of Water","slot":0,"source":[2,5,16],"subclass":10,firstseenpatch: 0,"avgbuyout":22230,"buyprice":1600,"cooldown":500,"sellprice":400,cost:[1600]},{"classs":0,"id":27860,"level":65,"name":"6Purified Draenic Water","reqlevel":65,"slot":0,"source":[2,5,21],"subclass":5,firstseenpatch: 0,"avgbuyout":2523,"buyprice":6400,"cooldown":1000,"reqlevel":65,"sellprice":320,cost:[6400]},{"classs":0,"id":35949,"level":65,"name":"6Tundra Berries","reqlevel":65,"slot":0,"source":[5],"subclass":5,firstseenpatch: 0,"avgbuyout":30000,"buyprice":8500,"cooldown":1000,"reqlevel":65,"sellprice":425,cost:[8500]},{"classs":7,"id":18567,"level":60,"name":"6Elemental Flux","slot":0,"source":[5],"subclass":7,firstseenpatch: 0,"buyprice":30000,"sellprice":7500,cost:[30000]},{"classs":7,"id":22785,"level":60,"name":"6Felweed","reqlevel":35,"slot":0,"source":[5,17],"subclass":9,firstseenpatch: 0,"avgbuyout":15642,"buyprice":2000,"reqskill":773,"reqskillrank":275,"sellprice":500,cost:[2000]},{"classs":7,"id":22786,"level":60,"name":"6Dreaming Glory","reqlevel":35,"slot":0,"source":[2,5,17],"subclass":9,firstseenpatch: 0,"avgbuyout":14355,"buyprice":2000,"reqskill":773,"reqskillrank":275,"sellprice":500,cost:[2000]},{"classs":7,"id":13467,"level":58,"name":"6Icecap","reqlevel":20,"slot":0,"source":[2,5,17],"subclass":9,firstseenpatch: 0,"avgbuyout":10250,"buyprice":1000,"reqskill":773,"reqskillrank":200,"sellprice":250,cost:[1000]},{"classs":7,"id":4342,"level":50,"name":"6Purple Dye","slot":0,"source":[5],"subclass":11,firstseenpatch: 0,"buyprice":2500,"sellprice":625,cost:[2500]},{"classs":7,"id":8846,"level":50,"name":"6Gromsblood","reqlevel":20,"slot":0,"source":[2,5,17],"sourcemore":[{"n":"Vi'el","t":1,"ti":16015,"z":618}],"subclass":9,firstseenpatch: 0,"avgbuyout":18398,"buyprice":1000,"reqskill":773,"reqskillrank":175,"sellprice":250,cost:[1000]},{"classs":7,"id":10290,"level":50,"name":"6Pink Dye","slot":0,"source":[5],"subclass":11,firstseenpatch: 0,"avgbuyout":1850,"buyprice":2500,"sellprice":625,cost:[2500]},{"classs":7,"id":10647,"level":50,"name":"6Engineer's Ink","slot":0,"source":[5],"subclass":1,firstseenpatch: 0,"avgbuyout":35000,"buyprice":2000,"sellprice":500,cost:[2000]},{"classs":7,"id":14256,"level":50,"name":"6Felcloth","slot":0,"source":[2,5],"sourcemore":[{"n":"Vi'el","t":1,"ti":16015,"z":618}],"subclass":5,firstseenpatch: 0,"avgbuyout":45000,"buyprice":8000,"sellprice":2000,cost:[8000]},{"classs":7,"id":14341,"level":50,"name":"6Rune Thread","slot":0,"source":[5],"subclass":5,firstseenpatch: 0,"avgbuyout":6900,"buyprice":5000,"sellprice":1250,cost:[5000]},{"classs":0,"id":34412,"level":45,"name":"6Sparkling Apple Cider","reqlevel":35,"slot":0,"source":[5],"subclass":0,firstseenpatch: 0,"buyprice":1000,"cooldown":1000,"manargn":332,"reqlevel":35,"sellprice":50,"spi":12,"sta":12,cost:[1000]},{"classs":7,"id":2325,"level":40,"name":"6Black Dye","slot":0,"source":[5],"subclass":11,firstseenpatch: 0,"buyprice":1000,"sellprice":250,cost:[1000]},{"classs":7,"commondrop":true,"id":4338,"level":40,"name":"6Mageweave Cloth","slot":0,"source":[2,5,21],"sourcemore":[{"n":"Andra","t":1,"ti":16631,"z":3487}],"subclass":5,firstseenpatch: 0,"avgbuyout":3860,"buyprice":1000,"sellprice":250,cost:[1000]},{"classs":7,"id":8343,"level":40,"name":"6Heavy Silken Thread","slot":0,"source":[5],"subclass":5,firstseenpatch: 0,"avgbuyout":20101,"buyprice":2000,"sellprice":500,cost:[2000]},{"classs":0,"id":2595,"level":35,"name":"6Jug of Badlands Bourbon","slot":0,"source":[2,5],"subclass":5,firstseenpatch: 0,"avgbuyout":45000,"buyprice":2000,"cooldown":1000,"sellprice":500,cost:[2000]},{"classs":7,"id":6261,"level":35,"name":"6Orange Dye","slot":0,"source":[5],"subclass":11,firstseenpatch: 0,"buyprice":1000,"sellprice":250,cost:[1000]},{"classs":7,"id":3357,"level":30,"name":"6Liferoot","reqlevel":5,"slot":0,"source":[2,5,17],"subclass":9,firstseenpatch: 0,"avgbuyout":9650,"buyprice":300,"reqskill":773,"reqskillrank":75,"sellprice":75,cost:[300]},{"classs":7,"id":3857,"level":30,"name":"6Coal","slot":0,"source":[2,5,16],"subclass":7,firstseenpatch: 0,"avgbuyout":5473,"buyprice":500,"sellprice":125,cost:[500]},{"classs":7,"id":4291,"level":30,"name":"6Silken Thread","slot":0,"source":[5],"subclass":5,firstseenpatch: 0,"avgbuyout":20000,"buyprice":500,"sellprice":125,cost:[500]},{"classs":7,"id":4306,"level":30,"name":"6Silk Cloth","slot":0,"source":[2,5,16,21],"sourcemore":[{"n":"Andra","t":1,"ti":16631,"z":3487}],"subclass":5,firstseenpatch: 0,"avgbuyout":4666,"buyprice":600,"sellprice":150,cost:[600]},{"classs":7,"id":11291,"level":30,"name":"6Star Wood","slot":0,"source":[5],"subclass":11,firstseenpatch: 0,"avgbuyout":37000,"buyprice":4500,"sellprice":1125,cost:[4500]},{"classs":7,"id":12037,"level":30,"name":"6Mystery Meat","slot":0,"source":[2,5],"sourcemore":[{"n":"Anton","t":1,"ti":24291,"z":495}],"subclass":8,firstseenpatch: 0,"avgbuyout":487,"buyprice":350,"sellprice":87,cost:[350]},{"classs":0,"id":2594,"level":25,"name":"6Flagon of Dwarven Mead","slot":0,"source":[2,5],"sourcemore":[{"bd":1,"dd":-1,"n":"Stomper Kreeg","t":1,"ti":14322,"z":2557}],"subclass":5,firstseenpatch: 0,"avgbuyout":50000,"buyprice":1500,"cooldown":1000,"sellprice":375,cost:[1500]},{"classs":7,"id":3466,"level":25,"name":"6Strong Flux","slot":0,"source":[5],"subclass":11,firstseenpatch: 0,"avgbuyout":20000,"buyprice":2000,"sellprice":500,cost:[2000]},{"classs":7,"id":4340,"level":25,"name":"6Gray Dye","slot":0,"source":[5],"subclass":11,firstseenpatch: 0,"avgbuyout":261,"buyprice":350,"sellprice":87,cost:[350]},{"classs":7,"id":4341,"level":25,"name":"6Yellow Dye","slot":0,"source":[5],"subclass":11,firstseenpatch: 0,"buyprice":500,"sellprice":125,cost:[500]},{"classs":7,"id":4400,"level":25,"name":"6Heavy Stock","slot":0,"source":[5],"subclass":1,firstseenpatch: 0,"avgbuyout":200,"buyprice":2000,"sellprice":500,cost:[2000]},{"classs":7,"id":3356,"level":24,"name":"6Kingsblood","reqlevel":5,"slot":0,"source":[2,5,17],"subclass":9,firstseenpatch: 0,"avgbuyout":9166,"buyprice":120,"reqskill":773,"reqskillrank":75,"sellprice":30,cost:[120]},{"classs":7,"id":3355,"level":22,"name":"6Wild Steelbloom","reqlevel":5,"slot":0,"source":[2,5,17],"subclass":9,firstseenpatch: 0,"avgbuyout":12300,"buyprice":200,"reqskill":773,"reqskillrank":75,"sellprice":50,cost:[200]},{"classs":7,"id":2321,"level":20,"name":"6Fine Thread","slot":0,"source":[5],"subclass":5,firstseenpatch: 0,"avgbuyout":111111,"buyprice":100,"sellprice":25,cost:[100]},{"classs":7,"id":2453,"level":20,"name":"6Bruiseweed","reqlevel":5,"slot":0,"source":[2,5,17],"subclass":9,firstseenpatch: 0,"avgbuyout":7954,"buyprice":100,"reqskill":773,"reqskillrank":25,"sellprice":25,cost:[100]},{"classs":7,"id":2771,"level":20,"name":"6Tin Ore","reqlevel":5,"slot":0,"source":[2,5,19],"sourcemore":[{"n":"Rathis Tomber","t":1,"ti":16224,"z":3433}],"subclass":7,firstseenpatch: 0,"avgbuyout":3705,"buyprice":100,"reqskill":755,"reqskillrank":50,"sellprice":25,cost:[100]},{"classs":7,"id":4232,"level":20,"name":"6Medium Hide","slot":0,"source":[2,5,23],"sourcemore":[{"n":"Murhane","t":1,"ti":44286,"z":4709}],"subclass":6,firstseenpatch: 0,"avgbuyout":14117,"buyprice":500,"sellprice":125,cost:[500]},{"classs":0,"id":6530,"level":20,"name":"6Nightcrawlers","reqlevel":1,"slot":0,"source":[2,5],"subclass":-3,firstseenpatch: 0,"avgbuyout":1000,"buyprice":100,"reqskill":356,"reqskillrank":50,"sellprice":25,cost:[100]},{"classs":7,"commondrop":true,"id":2592,"level":15,"name":"6Wool Cloth","slot":0,"source":[2,5,21],"sourcemore":[{"n":"Andra","t":1,"ti":16631,"z":3487}],"subclass":5,firstseenpatch: 0,"avgbuyout":7546,"buyprice":135,"sellprice":33,cost:[135]},{"classs":0,"id":2593,"level":15,"name":"6Flask of Stormwind Tawny","slot":0,"source":[2,5],"subclass":5,firstseenpatch: 0,"avgbuyout":34826,"buyprice":150,"cooldown":1000,"sellprice":37,cost:[150]},{"classs":0,"id":2596,"level":15,"name":"6Skin of Dwarven Stout","slot":0,"source":[2,5],"subclass":5,firstseenpatch: 0,"avgbuyout":40000,"buyprice":120,"cooldown":1000,"sellprice":30,cost:[120]},{"classs":7,"id":2605,"level":15,"name":"6Green Dye","slot":0,"source":[5],"subclass":11,firstseenpatch: 0,"avgbuyout":9000,"buyprice":100,"sellprice":25,cost:[100]},{"classs":7,"id":2775,"level":10,"name":"5Silver Ore","slot":0,"source":[2,5,19],"sourcemore":[{"n":"Rathis Tomber","t":1,"ti":16224,"z":3433}],"subclass":7,firstseenpatch: 0,"avgbuyout":54450,"buyprice":300,"sellprice":75,cost:[300]},{"classs":7,"id":10938,"level":10,"name":"5Lesser Magic Essence","slot":0,"source":[5,15],"subclass":12,firstseenpatch: 0,"avgbuyout":8200,"buyprice":800,"cooldown":1000,cost:[800]},{"classs":7,"id":785,"level":10,"name":"6Mageroyal","reqlevel":5,"slot":0,"source":[2,4,5,16,17],"sourcemore":[{"c":-181,"c2":5,"n":"Elixirs for the Bladeleafs","t":5,"ti":1581}],"subclass":9,firstseenpatch: 0,"avgbuyout":6450,"buyprice":80,"reqskill":773,"sellprice":20,cost:[80]},{"classs":7,"id":2449,"level":10,"name":"6Earthroot","reqlevel":5,"slot":0,"source":[2,4,5,17],"sourcemore":[{"c":-181,"c2":5,"n":"Elixirs for the Bladeleafs","t":5,"ti":1581}],"subclass":9,firstseenpatch: 0,"avgbuyout":2650,"buyprice":80,"reqskill":773,"reqskillrank":1,"sellprice":20,cost:[80]},{"classs":7,"id":2604,"level":10,"name":"6Red Dye","slot":0,"source":[5],"subclass":11,firstseenpatch: 0,"avgbuyout":10,"buyprice":50,"sellprice":12,cost:[50]},{"classs":7,"id":2770,"level":10,"name":"6Copper Ore","reqlevel":5,"slot":0,"source":[2,5,19],"sourcemore":[{"n":"Rathis Tomber","t":1,"ti":16224,"z":3433}],"subclass":7,firstseenpatch: 0,"avgbuyout":4940,"buyprice":20,"reqskill":755,"reqskillrank":1,"sellprice":5,cost:[20]},{"classs":7,"id":4289,"level":10,"name":"6Salt","slot":0,"source":[5],"subclass":6,firstseenpatch: 0,"avgbuyout":12498,"buyprice":50,"sellprice":12,cost:[50]},{"classs":7,"id":4399,"level":10,"name":"6Wooden Stock","slot":0,"source":[5],"subclass":1,firstseenpatch: 0,"avgbuyout":449000,"buyprice":200,"sellprice":50,cost:[200]},{"classs":7,"id":6260,"level":10,"name":"6Blue Dye","slot":0,"source":[5],"subclass":11,firstseenpatch: 0,"avgbuyout":109500,"buyprice":50,"sellprice":12,cost:[50]},{"classs":7,"id":10940,"level":10,"name":"6Strange Dust","slot":0,"source":[5,15],"subclass":12,firstseenpatch: 0,"avgbuyout":6199,"buyprice":800,cost:[800]},{"classs":7,"id":765,"level":5,"name":"6Silverleaf","reqlevel":5,"slot":0,"source":[2,5,17],"subclass":9,firstseenpatch: 0,"avgbuyout":2225,"buyprice":40,"reqskill":773,"reqskillrank":1,"sellprice":10,cost:[40]},{"classs":0,"id":1179,"level":5,"name":"6Ice Cold Milk","reqlevel":5,"slot":0,"source":[2,5,19],"subclass":5,firstseenpatch: 0,"avgbuyout":7500,"buyprice":125,"cooldown":1000,"manargn":120,"reqlevel":5,"sellprice":6,cost:[125]},{"classs":7,"id":2320,"level":5,"name":"6Coarse Thread","slot":0,"source":[5],"subclass":5,firstseenpatch: 0,"avgbuyout":5000,"buyprice":10,"sellprice":2,cost:[10]},{"classs":7,"id":2324,"level":5,"name":"6Bleach","slot":0,"source":[5],"subclass":11,firstseenpatch: 0,"buyprice":25,"sellprice":6,cost:[25]},{"classs":7,"id":2447,"level":5,"name":"6Peacebloom","reqlevel":5,"slot":0,"source":[2,5,17],"subclass":9,firstseenpatch: 0,"avgbuyout":2673,"buyprice":40,"reqskill":773,"reqskillrank":1,"sellprice":10,cost:[40]},{"classs":7,"commondrop":true,"id":2589,"level":5,"name":"6Linen Cloth","slot":0,"source":[2,5,16,17,19,21,23],"sourcemore":[{"n":"Andra","t":1,"ti":16631,"z":3487}],"subclass":5,firstseenpatch: 0,"avgbuyout":1803,"buyprice":55,"sellprice":13,cost:[55]},{"classs":7,"id":2678,"level":5,"name":"6Mild Spices","slot":0,"source":[5],"subclass":11,firstseenpatch: 0,"avgbuyout":1250,"buyprice":10,cost:[10]},{"classs":7,"id":2880,"level":5,"name":"6Weak Flux","slot":0,"source":[5],"subclass":11,firstseenpatch: 0,"buyprice":100,"sellprice":25,cost:[100]},{"classs":7,"id":4470,"level":5,"name":"6Simple Wood","slot":0,"source":[5],"subclass":11,firstseenpatch: 0,"avgbuyout":44000,"buyprice":38,"sellprice":9,cost:[38]},{"classs":0,"id":4537,"level":5,"name":"6Tel'Abim Banana","reqlevel":5,"slot":0,"source":[2,5,21],"subclass":5,firstseenpatch: 0,"avgbuyout":6000000,"buyprice":125,"cooldown":1000,"reqlevel":5,"sellprice":6,cost:[125]},{"classs":7,"id":6217,"level":5,"name":"6Copper Rod","slot":0,"source":[5],"subclass":12,firstseenpatch: 0,"avgbuyout":70000,"buyprice":124,"sellprice":24,"speed":2.00,cost:[124]},{"classs":15,"id":17194,"level":5,"name":"6Holiday Spices","slot":0,"source":[5],"subclass":3,firstseenpatch: 0,"avgbuyout":9000,"buyprice":10,cost:[10]},{"classs":15,"id":17202,"level":5,"name":"6Snowball","slot":0,"source":[2,5],"subclass":3,firstseenpatch: 0,"avgbuyout":4900,"buyprice":10,"cooldown":1000,cost:[10]},{"classs":7,"id":30817,"level":5,"name":"6Simple Flour","slot":0,"source":[5],"subclass":11,firstseenpatch: 0,"avgbuyout":10000,"buyprice":25,"sellprice":1,cost:[25]},{"classs":7,"id":44835,"level":5,"name":"6Autumnal Herbs","slot":0,"source":[5],"subclass":11,firstseenpatch: 0,"buyprice":10,cost:[10]},{"classs":2,"displayid":6568,"dps":2.6,"id":2901,"level":4,"name":"6Mining Pick","slot":21,"slotbak":21,"source":[5],"speed":2.00,"subclass":14,firstseenpatch: 0,"avgbuyout":2,"buyprice":81,"displayid":6568,"dmgmax1":8,"dmgmin1":3,"dmgrange":0.60,"dmgtype1":0,"dps":2.6,"dura":20,"mledmgmax":8,"mledmgmin":3,"mledps":2.6,"mlespeed":2.00,"reqlevel":1,"reqskill":186,"reqskillrank":1,"sellprice":16,"slotbak":21,"speed":2.00,cost:[81]},{"classs":2,"displayid":2706,"dps":2.6,"id":7005,"level":4,"name":"6Skinning Knife","slot":13,"slotbak":13,"source":[2,5],"sourcemore":[{"icon":"inv_crate_05","n":"Crate of Meat","q":1,"t":3,"ti":33857}],"speed":1.60,"subclass":14,firstseenpatch: 0,"avgbuyout":20000000,"buyprice":82,"displayid":2706,"dmgmax1":6,"dmgmin1":2,"dmgrange":0.60,"dmgtype1":0,"dps":2.6,"dura":20,"mledmgmax":6,"mledmgmin":2,"mledps":2.6,"mlespeed":1.60,"reqlevel":1,"reqskill":393,"reqskillrank":1,"sellprice":16,"slotbak":13,"speed":1.60,cost:[82]},{"classs":0,"id":159,"level":1,"name":"6Refreshing Spring Water","reqlevel":5,"slot":0,"source":[2,4,5,16],"subclass":5,firstseenpatch: 0,"avgbuyout":100000,"buyprice":25,"cooldown":1000,"manargn":50,"reqlevel":1,"sellprice":1,cost:[25]},{"classs":7,"id":3371,"level":1,"name":"6Crystal Vial","slot":0,"source":[2,5,16],"subclass":11,firstseenpatch: 0,"avgbuyout":39800,"buyprice":100,"sellprice":5,cost:[100]},{"classs":12,"id":5051,"level":1,"name":"6Dig Rat","slot":0,"source":[2,5],"sourcemore":[{"n":"Dig Rat","t":1,"ti":3444,"z":4709},{"n":"Grub","t":1,"ti":3443,"z":17}],"subclass":0,firstseenpatch: 0,"buyprice":1,"sellprice":1,cost:[1]},{"classs":2,"displayid":8568,"dps":1.9,"id":5956,"level":1,"name":"6Blacksmith Hammer","slot":21,"slotbak":21,"source":[5],"speed":2.00,"subclass":14,firstseenpatch: 0,"avgbuyout":30000,"buyprice":18,"displayid":8568,"dmgmax1":6,"dmgmin1":2,"dmgrange":0.60,"dmgtype1":0,"dps":1.9,"dura":16,"mledmgmax":6,"mledmgmin":2,"mledps":1.9,"mlespeed":2.00,"reqlevel":1,"sellprice":3,"slotbak":21,"speed":2.00,cost:[18]},{"classs":0,"id":9260,"level":1,"name":"6Volatile Rum","slot":0,"source":[2,5],"subclass":5,firstseenpatch: 0,"avgbuyout":20000,"buyprice":1600,"sellprice":400,cost:[1600]},{"classs":0,"id":17196,"level":1,"name":"6Holiday Spirits","slot":0,"source":[5],"subclass":5,firstseenpatch: 0,"avgbuyout":19800,"buyprice":50,"cooldown":1000,"reqlevel":1,"sellprice":12,cost:[50]},{"classs":7,"id":39354,"level":1,"name":"6Light Parchment","slot":0,"source":[5],"subclass":11,firstseenpatch: 0,"avgbuyout":77390,"buyprice":15,"sellprice":3,cost:[15]},{"classs":7,"id":44853,"level":1,"name":"6Honey","slot":0,"source":[5],"subclass":11,firstseenpatch: 0,"buyprice":25,"sellprice":1,cost:[25]},{"classs":0,"id":44854,"level":1,"name":"6Tangy Wetland Cranberries","slot":0,"source":[5],"sourcemore":[{"z":1}],"subclass":5,firstseenpatch: 0,"buyprice":25,"cooldown":1000,"reqlevel":1,"sellprice":1,cost:[25]},{"classs":0,"id":44855,"level":1,"name":"6Teldrassil Sweet Potato","slot":0,"source":[5],"sourcemore":[{"z":1657}],"subclass":5,firstseenpatch: 0,"buyprice":25,"cooldown":1000,"reqlevel":1,"sellprice":1,cost:[25]},{"classs":0,"id":46784,"level":1,"name":"6Ripe Elwynn Pumpkin","slot":0,"source":[5],"sourcemore":[{"z":12}],"subclass":5,firstseenpatch: 0,"buyprice":25,"cooldown":1000,"reqlevel":1,"sellprice":1,cost:[25]},{"classs":0,"id":46793,"level":1,"name":"6Tangy Southfury Cranberries","slot":0,"source":[5],"sourcemore":[{"z":14}],"subclass":5,firstseenpatch: 0,"buyprice":25,"cooldown":1000,"reqlevel":1,"sellprice":1,cost:[25]},{"classs":0,"id":46796,"level":1,"name":"6Ripe Tirisfal Pumpkin","slot":0,"source":[5],"sourcemore":[{"z":1497}],"subclass":5,firstseenpatch: 0,"buyprice":25,"cooldown":1000,"reqlevel":1,"sellprice":1,cost:[25]},{"classs":0,"id":46797,"level":1,"name":"6Mulgore Sweet Potato","slot":0,"source":[5],"sourcemore":[{"z":1638}],"subclass":5,firstseenpatch: 0,"buyprice":25,"cooldown":1000,"reqlevel":1,"sellprice":1,cost:[25]},{"classs":2,"displayid":1716,"dps":2.5,"id":79740,"level":1,"name":"6Plain Wooden Staff","slot":17,"slotbak":17,"source":[5],"speed":2.50,"subclass":10,firstseenpatch: 0,"avgbuyout":999999,"buyprice":23,"displayid":1716,"dmgmax1":9,"dmgmin1":5,"dmgrange":0.40,"dmgtype1":0,"dps":2.5,"dura":25,"mledmgmax":9,"mledmgmin":5,"mledps":2.5,"mlespeed":2.50,"reqlevel":1,"sellprice":4,"slotbak":17,"speed":2.50,cost:[23]}
EOF;

$itms = json_decode2($thejson);
//print_r($itms);
//echo "-------------\n";

//these are unique vendors that are the only source for the given goods, but anyone can get to them and buy their unlimited-supply stuff
$allowedvendors = Array(14322,31247,19227,49406,61650);

//these are items that are excluded from the vendor list (probably because they are crafted) but should be considered vendor
$forcevendor = array();
$forcevendor[90146] = 20000; //tinker's kit

// items that are sold by vendors for gold but should be considered gathered
// northern spices, felcloth, strange dust, elementium ore, embersilk cloth, hypnotic dust, lesser magic essence
$forbiddenitems = Array(43007,14256,10940,52185,53010,52555,10938,74853);

// also exclude all herbs and elemental (motes, etc) trade goods
$sql = 'select id from tblItem where class=7 and subclass in (9,10)';
$rst = get_rst($sql);
while ($row = next_row($rst)) $forbiddenitems[] = intval($row['id']);


foreach ($itms as $itm) {
	$gooditem = true;
	if (isset($itm['sourcemore'])) 
		foreach ($itm['sourcemore'] as $src) 
			if (isset($src['t'])) {
				if (($src['t']==1) && (!in_array($src['ti'],$allowedvendors))) 
					$gooditem=false;
			} /* else {
				echo "no t:\n";
				print_r($itm);
			} */
	if (in_array($itm['id'],$forbiddenitems)) $gooditem=false;
	if (isset($itm['cost']) && (strpos($itm['cost'],'[') !== false)) 
		$gooditem = false;
	$price = 0;
	if ($gooditem) {
		unset($sellprice); unset($buyprice);
		if (isset($itm['sellprice'])) $sellprice = $itm['sellprice'] * 4;
		if (isset($itm['buyprice'])) $buyprice = $itm['buyprice'];

		if (isset($sellprice) && isset($buyprice) && ($sellprice != $buyprice)) { // && (floor($buyprice/4) != floor($sellprice/4))) {
			echo substr($itm['name'],1).": *** sell/buy mismatch: $sellprice vs $buyprice ..";
			if (file_exists('vendoritems.wowheadcache/'.$itm['id'].'.html')) {
				$wh = file_get_contents('vendoritems.wowheadcache/'.$itm['id'].'.html');
			} else {
				$wh = get_url_old('http://www.wowhead.com/item='.$itm['id']);
				file_put_contents('vendoritems.wowheadcache/'.$itm['id'].'.html',$wh);
			}
			$stacksize = 0;
			if (preg_match('/\n[^\n]+\'npc\', id: \'sold-by\'([^\n]+)+\n/',$wh,$res) > 0) {
				$c = preg_match_all('/\bstack:(\d+)/',$res[1],$res2);
				for ($x = 0; $x < $c; $x++) $stacksize=max($stacksize,intval($res2[1][$x]));
			}
			$price = $buyprice; 
			if ($stacksize != 0) $price = round($price / $stacksize);
		} else {
			if (isset($itm['sellprice'])) $price = $itm['sellprice'] * 4;
			if (isset($itm['buyprice'])) $price = $itm['buyprice'];
			echo substr($itm['name'],1).":";
		}

		echo " $price ".run_sql('replace into tblDBCItemVendorCost (item, copper) values (\''.sql_esc($itm['id']).'\', \''.sql_esc($price).'\')')."\n";
	}
}

foreach ($forcevendor as $iid => $c) 
	run_sql('replace into tblDBCItemVendorCost (item, copper) values (\''.sql_esc($iid).'\', \''.sql_esc($c).'\')');


?>
